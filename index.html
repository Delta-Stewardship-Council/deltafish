<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Accesses an Integrated Fish Count and Length Dataset from the San Francisco Delta â€¢ deltafish</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Accesses an Integrated Fish Count and Length Dataset from the San Francisco Delta">
<meta name="description" content="This package enables streamlined access to a large (45 million observation) integrated fish dataset from the San Fransisco Delta. The package downloads published data and stores it in parquet files as an `arrow` dataset in a local cache. Helper functions enable efficient querying of this large dataset.">
<meta property="og:description" content="This package enables streamlined access to a large (45 million observation) integrated fish dataset from the San Fransisco Delta. The package downloads published data and stores it in parquet files as an `arrow` dataset in a local cache. Helper functions enable efficient querying of this large dataset.">
<meta property="og:image" content="https://delta-stewardship-council.github.io/deltafish/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">deltafish</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/delta-stewardship-council/deltafish/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="deltafish-">deltafish 
<a class="anchor" aria-label="anchor" href="#deltafish-"></a>
</h1>
</div>
<p>Credit to <a href="https://github.com/bmahardja" class="external-link">Brian Mahardja</a> for the Delta Smelt drawing in the logo.</p>
<!-- badges: start -->

<p>The goal of <code>deltafish</code> is to provide easy access to the <a href="https://portal.edirepository.org/nis/mapbrowse?scope=edi&amp;identifier=1075&amp;revision=1" class="external-link">integrated San Fransisco estuary Delta fish dataset</a>. This dataset is published, citeable, and documented on <a href="https://portal.edirepository.org/nis/mapbrowse?scope=edi&amp;identifier=1075&amp;revision=1" class="external-link">EDI</a>. The dataset contains around 45 million rows, which are not easily queryable with normal R techniques. <code>deltafish</code> utilizes <a href="https://rsqlite.r-dbi.org/articles/RSQLite.html" class="external-link">RSQLite</a>, along with <code>dbplyr</code> to make the process of working with this large dataset much easier on a standard computer.</p>
<p>You can use <code>dplyr</code> verbs to query the database in much the same way as you would a <code>data.frame</code>. Instead of computing your function return value every time you execute a <code>dplyr</code> function call, <code>dbplyr</code> builds a query on the backend which is only run when you <code><a href="reference/collect_data.html">collect_data()</a></code> the data. This means you execute far fewer queries and are able to work with the data much more efficiently.</p>
<p>We recommend you use the <code><a href="reference/collect_data.html">collect_data()</a></code> function from this package instead of the <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> function from <code>dplyr</code> because <code><a href="reference/collect_data.html">collect_data()</a></code> will convert the Date and Datetime columns in your dataset, if present, into the appropriate format with the appropriate time zone. This is necessary because SQLite does not have a data format for dates and datetimes. Instead, those columns are stored as text. SQLite can still perform some operations on them (e.g., you can filter based on date as in the example below), but they remained stored as text instead of date and datetime formats.</p>
<p>Unless you are familiar with SQLite, you may want to only perform simple operations such as <code>filter</code>, <code>select</code>, and <code>join</code> before you <code><a href="reference/collect_data.html">collect_data()</a></code> and then can run any R operation on the dataset. You can perform more complex operations like <code>mutate</code> and <code>summarise</code> but some R expressions cannot be translated to SQLite and will return an error. If you are familiar with SQLite, you can alternatively interact with the database using SQLite queries through the <code>RSQLite</code> package.</p>
<p>To begin, install the package as below and run <code><a href="reference/create_fish_db.html">create_fish_db()</a></code>. This will download the data and create the SQLite database.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the package via github:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"Delta-Stewardship-Council/deltafish"</span><span class="op">)</span></span></code></pre></div>
<p>Or via r-universe:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Enable this universe</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    sbashevkin <span class="op">=</span> <span class="st">'https://sbashevkin.r-universe.dev'</span>,</span>
<span>    CRAN <span class="op">=</span> <span class="st">'https://cloud.r-project.org'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install the package</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'deltafish'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>First build the database. This takes a bit to run since the source data are large.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/delta-stewardship-council/deltafish/" class="external-link">deltafish</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/create_fish_db.html">create_fish_db</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Then open and query data. You have to first open a connection to the database with <code><a href="reference/open_database.html">open_database()</a></code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dplyr required for queries below</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/delta-stewardship-council/deltafish/" class="external-link">deltafish</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/open_database.html">open_database</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># open our two data tables</span></span>
<span><span class="va">surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/open_survey.html">open_survey</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span>
<span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/open_fish.html">open_fish</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filter for sources and taxa of interest</span></span>
<span><span class="co"># Also filter for dates of interest. Although dates and datetimes are stored as text in the dataset,</span></span>
<span><span class="co"># you can still filter on them using text strings in the "YYYY-MM-DD" or "YYYY-MM-DD HH:MM:SS" format.</span></span>
<span></span>
<span><span class="va">surv_FMWT</span> <span class="op">&lt;-</span> <span class="va">surv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Source</span> <span class="op">==</span> <span class="st">"FMWT"</span> <span class="op">&amp;</span> <span class="va">Date</span> <span class="op">&gt;</span> <span class="st">"1999-01-01"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SampleID</span>, <span class="va">Date</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fish_smelt</span> <span class="op">&lt;-</span> <span class="va">fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Taxa</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Dorosoma petenense"</span>, <span class="st">"Morone saxatilis"</span>, <span class="st">"Spirinchus thaleichthys"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># do a join and collect_data the resulting data frame</span></span>
<span><span class="co"># collect_data executes the sql query, converts Date and Datetime columns to the correct format and timezone, and gives you a table</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">surv_FMWT</span>, <span class="va">fish_smelt</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="reference/collect_data.html">collect_data</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="co"># close connection to database</span></span>
<span><span class="fu"><a href="reference/close_database.html">close_database</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-updating-and-versioning">Data updating and versioning<a class="anchor" aria-label="anchor" href="#data-updating-and-versioning"></a>
</h2>
<p>When the integrated dataset is updated, you do not necessarily need to update your installation of the <code>deltafish</code> package, although you will need to use a version equal to or greater than 1 to work with the data publication version 2 or later. You can access the latest data by re-building the cached database via</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/delta-stewardship-council/deltafish/" class="external-link">deltafish</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/create_fish_db.html">create_fish_db</a></span><span class="op">(</span>update<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Or, you can specify the exact version of the data package you wish to use. This enables reproducibility by ensuring the correct data package version is used.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/delta-stewardship-council/deltafish/" class="external-link">deltafish</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/create_fish_db.html">create_fish_db</a></span><span class="op">(</span>edi_pid<span class="op">=</span><span class="st">"edi.1075.1"</span><span class="op">)</span></span></code></pre></div>
<p>To create a fully reproducible workflow, you should also note the <code>deltafish</code> package version used, which could always be installed later with e.g.,</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"Delta-Stewardship-Council/deltafish"</span>, ref<span class="op">=</span><span class="st">"v0.2.0"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/delta-stewardship-council/deltafish/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/delta-stewardship-council/deltafish/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing deltafish</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Jeanette Clark <br><small class="roles"> Author </small> <a href="https://orcid.org/https://orcid.org/0000-0003-4703-1974" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Samuel M Bashevkin <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/https://orcid.org/0000-0001-7406-7089" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/Delta-Stewardship-Council/deltafish/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/Delta-Stewardship-Council/deltafish/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/Delta-Stewardship-Council/deltafish?branch=main" class="external-link"><img src="https://codecov.io/gh/Delta-Stewardship-Council/deltafish/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://sbashevkin.r-universe.dev/ui#package:deltafish" class="external-link"><img src="https://sbashevkin.r-universe.dev/badges/deltafish" alt="r-universe"></a></li>
<li><a href="https://doi.org/10.5281/zenodo.6484439" class="external-link"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.6484439.svg" alt="DOI"></a></li>
<li><a href="https://portal.edirepository.org/nis/mapbrowse?scope=edi&amp;identifier=1075" class="external-link"><img src="https://img.shields.io/badge/Data%20publication%20DOI-10.6073/pasta/0cdf7e5e954be1798ab9bf4f23816e83-blue.svg" alt="Data DOI"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jeanette Clark, Samuel M Bashevkin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
